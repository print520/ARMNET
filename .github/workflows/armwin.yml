name: Windows ARM64 æ„å»º (å…¬å¼€ä»“åº“ç‰ˆæœ¬)

# è¿™ä¸ªæ–‡ä»¶åº”è¯¥æ”¾åœ¨å…¬å¼€ä»“åº“ä¸­
# å®ƒä¼šæ‹‰å–ç§æœ‰ä»“åº“çš„ä»£ç è¿›è¡Œ Windows ARM æ¶æ„æ„å»º

# ============================================
# é…ç½®ç§æœ‰ä»“åº“ä¿¡æ¯ï¼ˆåœ¨è¿™é‡Œä¿®æ”¹ï¼‰
# ============================================
env:
  PRIVATE_REPO: 'print520/NetAPP'  # ä¿®æ”¹ä¸ºä½ çš„ç§æœ‰ä»“åº“åœ°å€ (æ ¼å¼: owner/repo)
  PRIVATE_REPO_REF: 'main'         # ä¿®æ”¹ä¸ºä½ è¦æ„å»ºçš„åˆ†æ”¯/æ ‡ç­¾/commit

on:
  workflow_dispatch:
    inputs:
      config_urls:
        description: 'é…ç½®URLåˆ—è¡¨ï¼ˆä»¥é€—å·åˆ†éš”ï¼‰'
        required: true
        default: ''
      update_url:
        description: 'æ›´æ–°æ£€æŸ¥URL'
        required: true
        default: ''
      app_id:
        description: 'åº”ç”¨ID(ä»…é™è‹±æ–‡å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿)'
        required: true
        default: ''
      display_name:
        description: 'æ˜¾ç¤ºåç§°(æ”¯æŒä¸­æ–‡)'
        required: true
        default: ''
      icon_url:
        description: 'åº”ç”¨å›¾æ ‡URL'
        required: true
        default: ''
      identifier:
        description: 'åº”ç”¨idè¯†åˆ«ç '
        required: true
        default: ''
      version:
        description: 'ç‰ˆæœ¬å·'
        required: true
        default: '2.0.1'
      test_url:
        description: 'æµ‹é€ŸURL'
        required: true
        default: 'http://cp.cloudflare.com/generate_204'

jobs:
  build-windows-arm64:
    # ä½¿ç”¨ Windows ARM æ¶æ„çš„ runner
    runs-on: windows-11-arm
    
    steps:
      # ============================================
      # æ­¥éª¤ 1: æ£€å‡ºç§æœ‰ä»“åº“ä»£ç 
      # ============================================
      - name: æ£€å‡ºç§æœ‰ä»“åº“ä»£ç 
        uses: actions/checkout@v4
        with:
          repository: ${{ env.PRIVATE_REPO }}
          ref: ${{ env.PRIVATE_REPO_REF }}
          token: ${{ secrets.PRIVATE_REPO_TOKEN }}
          submodules: recursive
      
      # ============================================
      # æ­¥éª¤ 2: è®¾ç½® Rust ç¯å¢ƒ (Windows ARM éœ€è¦)
      # ============================================
      - name: è®¾ç½® Rust ç¯å¢ƒ
        run: |
          Invoke-WebRequest -Uri "https://win.rustup.rs/aarch64" -OutFile rustup-init.exe
          .\rustup-init.exe -y --default-toolchain stable
          $cargoPath = "$env:USERPROFILE\.cargo\bin"
          Add-Content $env:GITHUB_PATH $cargoPath
        shell: pwsh

      # ============================================
      # æ­¥éª¤ 3: è·å–åº”ç”¨å›¾æ ‡
      # ============================================
      - name: è·å–åº”ç”¨å›¾æ ‡
        run: |
          mkdir -p temp_icons
          curl -L ${{ github.event.inputs.icon_url }} -o temp_icons/app_icon.png
        shell: bash

      # ============================================
      # æ­¥éª¤ 4: ä¿®æ”¹é…ç½®URLs
      # ============================================
      - name: ä¿®æ”¹é…ç½®URLs
        run: |
          $configFile = "lib/common/config_service.dart"
          $configUrls = "${{ github.event.inputs.config_urls }}" -split ","
          
          # è¯»å–åŸå§‹æ–‡ä»¶å†…å®¹
          $content = Get-Content $configFile -Raw
          
          # æ„å»ºæ–°çš„URLsæ•°ç»„å­—ç¬¦ä¸²
          $newUrls = "["
          for ($i = 0; $i -lt $configUrls.Count; $i++) {
            $url = $configUrls[$i].Trim()
            $newUrls += "`n    '$url'"
            if ($i -lt ($configUrls.Count - 1)) {
              $newUrls += ","
            }
          }
          $newUrls += "`n  ]"
          
          # ä½¿ç”¨ç²¾ç¡®åŒ¹é…æ¨¡å¼æ›¿æ¢
          $pattern = "static const List<String> _configUrls = \[[^\]]*\];"
          $replacement = "static const List<String> _configUrls = $newUrls;"
          
          # ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢
          $content = [regex]::Replace($content, $pattern, $replacement)
          
          # å†™å›æ–‡ä»¶
          $content | Set-Content $configFile -Force -Encoding UTF8
          
          # ç¡®è®¤ä¿®æ”¹
          Write-Host "å·²ä¿®æ”¹é…ç½®URLs:"
          Get-Content $configFile | Select-String -Context 0,5 "_configUrls"
        shell: pwsh

      # ============================================
      # æ­¥éª¤ 5: ä¿®æ”¹æ›´æ–°URL
      # ============================================
      - name: ä¿®æ”¹æ›´æ–°URL
        run: |
          $apiFile = "lib/common/api_service.dart"
          $updateUrl = "${{ github.event.inputs.update_url }}"
          
          # æ›¿æ¢æ›´æ–°URL
          if (Test-Path $apiFile) {
            (Get-Content $apiFile) -replace "final customUpdateUrl = \'[^\']*\';", "final customUpdateUrl = '$updateUrl';" | Set-Content $apiFile
            Write-Host "å·²ä¿®æ”¹æ›´æ–°URL:"
            Get-Content $apiFile | Select-String "customUpdateUrl"
          } else {
            Write-Host "è­¦å‘Š: APIæ–‡ä»¶ $apiFile ä¸å­˜åœ¨ï¼Œè·³è¿‡æ›´æ–°URLä¿®æ”¹"
          }
        shell: pwsh

      # ============================================
      # æ­¥éª¤ 6: æ›¿æ¢æµ‹é€ŸURL
      # ============================================
      - name: æ›¿æ¢æµ‹é€ŸURL defaultTestUrl
        run: |
          $testUrl = "${{ github.event.inputs.test_url }}"
          $file = "lib/common/constant.dart"
          if (Test-Path $file) {
            (Get-Content $file -Raw) -replace "const defaultTestUrl = '[^']*';", "const defaultTestUrl = '$testUrl';" | Set-Content $file -Encoding UTF8
            Get-Content $file | Select-String 'defaultTestUrl'
          } else {
            Write-Host "æœªæ‰¾åˆ° $file"
          }
        shell: pwsh

      # ============================================
      # æ­¥éª¤ 7: ä¿®æ”¹ distribute_options.yaml ä¸­çš„åº”ç”¨åç§°
      # ============================================
      - name: ä¿®æ”¹ distribute_options.yaml ä¸­çš„åº”ç”¨åç§°
        run: |
          $displayName = "${{ github.event.inputs.display_name }}"
          $distributeFile = "distribute_options.yaml"
          
          if (Test-Path $distributeFile) {
            # è¯»å–æ–‡ä»¶å†…å®¹
            $content = Get-Content $distributeFile -Raw
            
            # ä¿®æ”¹ app_name å±æ€§
            $content = $content -replace "app_name: 'FlClash'", "app_name: '$displayName'"
            $content = $content -replace "app_name: `"FlClash`"", "app_name: `"$displayName`""
            
            # å†™å›æ–‡ä»¶
            $content | Set-Content $distributeFile -Force
            
            Write-Host "å·²ä¿®æ”¹ distribute_options.yaml ä¸­çš„åº”ç”¨åç§°ä¸º: $displayName"
          } else {
            Write-Host "è­¦å‘Š: æ‰¾ä¸åˆ° distribute_options.yaml æ–‡ä»¶"
          }
        shell: pwsh

      # ============================================
      # æ­¥éª¤ 8: ä¿®æ”¹æ˜¾ç¤ºåç§°å’Œç‰ˆæœ¬
      # ============================================
      - name: ä¿®æ”¹æ˜¾ç¤ºåç§°å’Œç‰ˆæœ¬
        run: |
          # ä½¿ç”¨è¾“å…¥çš„æ˜¾ç¤ºåç§°
          $displayName = "${{ github.event.inputs.display_name }}"
          $app_id = "${{ github.event.inputs.app_id }}"
          $identifier = "${{ github.event.inputs.identifier }}"
          
          # ä¿®æ”¹Windowsé…ç½®ä¸­çš„æ˜¾ç¤ºåç§° - ä»…ä¿®æ”¹display_name
          if (Test-Path "windows/packaging/exe/make_config.yaml") {
            # è¯»å–æ–‡ä»¶å†…å®¹
            $content = Get-Content 'windows/packaging/exe/make_config.yaml' -Raw
            
            # ä¿®æ”¹åº”ç”¨å†…éƒ¨åç§° æ˜¾ç¤ºåç§° å”¯ä¸€è¯†åˆ«id
            $content = $content -replace "display_name: .*", "display_name: $displayName"
            $content = $content -replace "app_name: .*", "app_name: $app_id"
            $content = $content -replace "executable_name: .*", "executable_name: ${app_id}.exe"
            $content = $content -replace "output_base_file_name: .*", "output_base_file_name: ${displayName}.exe"
            $content = $content -replace "app_id: .*", "app_id: $identifier"
            
            # æ·»åŠ æˆ–ä¿®æ”¹å®‰è£…ç›®å½•åç§°ï¼Œä½¿ç”¨è‹±æ–‡app_idé¿å…ä¸­æ–‡ç›®å½•å
            if ($content -match "install_dir_name:") {
              $content = $content -replace "install_dir_name: .*", "install_dir_name: `"{autopf64}\\$app_id`""
            } else {
              $content += "`ninstall_dir_name: `"{autopf64}\\$app_id`""
            }
            
            # å†™å›æ–‡ä»¶
            $content | Set-Content 'windows/packaging/exe/make_config.yaml' -Force
            
            Write-Host "å·²æ›´æ–°Windowsåº”ç”¨æ˜¾ç¤ºåç§°é…ç½®:"
            Get-Content 'windows/packaging/exe/make_config.yaml'
          }
          
          # ä¿®æ”¹ CMakeLists.txt - ä½¿ç”¨ç²¾ç¡®æ›¿æ¢é¿å…æ„å¤–æ›¿æ¢
          $cmake_file = "windows/CMakeLists.txt"
          if (Test-Path $cmake_file) {
            $content = Get-Content $cmake_file -Raw
            
            # ç²¾ç¡®æ›¿æ¢å…³é”®ä½ç½®ï¼Œé¿å…å…¨å±€æ›¿æ¢
            $content = $content.Replace('project(FlClash LANGUAGES CXX)', "project($app_id LANGUAGES CXX)")
            $content = $content.Replace('set(BINARY_NAME "FlClash")', "set(BINARY_NAME `"$app_id`")")
            $content = $content.Replace('FlClashCore.exe', "${app_id}Core.exe")
            $content = $content.Replace('FlClashHelperService.exe', "${app_id}HelperService.exe")
            
            $content | Set-Content $cmake_file -Force -Encoding UTF8
            
            Write-Host "å·²ç²¾ç¡®ä¿®æ”¹ CMakeLists.txt ä¸­çš„å…³é”®å¼•ç”¨" -ForegroundColor Green
            
            # éªŒè¯æ›¿æ¢ç»“æœ
            Write-Host "`néªŒè¯æ›¿æ¢ç»“æœ:" -ForegroundColor Yellow
            Get-Content $cmake_file | Select-String -Pattern "project\(|BINARY_NAME|Core\.exe|HelperService\.exe" | ForEach-Object { Write-Host "  $_" -ForegroundColor Cyan }
          } else {
            Write-Host "è­¦å‘Š: æ‰¾ä¸åˆ° $cmake_file æ–‡ä»¶" -ForegroundColor Red
          }
        shell: pwsh

      # ============================================
      # æ­¥éª¤ 9: ä¿®æ”¹ç‰ˆæœ¬å·å’Œåº”ç”¨åç§°
      # ============================================
      - name: ä¿®æ”¹ç‰ˆæœ¬å·å’Œåº”ç”¨åç§°
        run: |
          # ä½¿ç”¨è¾“å…¥çš„æ˜¾ç¤ºåç§°
          $displayName = "${{ github.event.inputs.display_name }}"
          $app_id = "${{ github.event.inputs.app_id }}"
          $identifier = "${{ github.event.inputs.identifier }}"
          
          # ä¿®æ”¹ç‰ˆæœ¬å·
          $version = "${{ github.event.inputs.version }}"
          $buildNumber = Get-Date -Format "yyyyMMddHH"
          # åŒ¹é…å¯é€‰çš„ build number
          (Get-Content pubspec.yaml) -replace "version: [0-9]+\.[0-9]+\.[0-9]+(\+[0-9]+)?", "version: $version+$buildNumber" | Set-Content pubspec.yaml
          
          # ä¿®æ”¹ constant.dart ä¸­çš„ appNameï¼ˆç”¨äºæ³¨å†Œè¡¨é”®åå’Œè‡ªå¯åŠ¨ï¼‰
          $constantFile = "lib/common/constant.dart"
          if (Test-Path $constantFile) {
            # ä½¿ç”¨ app_id ä½œä¸ºå†…éƒ¨æ ‡è¯†ç¬¦ï¼ˆç”¨äºæ³¨å†Œè¡¨ç­‰ï¼‰ï¼Œé¿å…ä½¿ç”¨ä¸­æ–‡
            $content = Get-Content $constantFile -Raw
            # åªæ”¯æŒå•å¼•å·ï¼ˆä»£ç ä¸­ä½¿ç”¨çš„æ ¼å¼ï¼‰
            $content = $content -replace "const appName = '[^']+';", "const appName = '$app_id';"
            $content | Set-Content $constantFile -NoNewline
            Write-Host "å·²æ›´æ–° constant.dart ä¸­çš„ appName ä¸º: $app_id"
            Get-Content $constantFile | Select-String -Pattern "const appName"
          }
          
          # æŸ¥çœ‹ä¿®æ”¹åçš„æ–‡ä»¶
          Get-Content pubspec.yaml | Select-String -Pattern "version:"
        shell: pwsh

      # ============================================
      # æ­¥éª¤ 10: æ›¿æ¢å›¾æ ‡ - Windows (ä½¿ç”¨ Python Pillow)
      # ============================================
      - name: æ›¿æ¢å›¾æ ‡ - Windows
        run: |
          # å®‰è£… Pillow åº“ï¼ˆæ›´å¯é çš„å›¾åƒå¤„ç†æ–¹æ¡ˆï¼‰
          python -m pip install --upgrade pip
          pip install Pillow
          
          # åˆ›å»º Python è„šæœ¬æ¥å¤„ç†å›¾æ ‡è½¬æ¢
          @"
          import sys
          import io
          from PIL import Image
          import os
          
          # è®¾ç½® UTF-8 è¾“å‡ºï¼Œé¿å…ç¼–ç é”™è¯¯
          sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8')
          
          # è¯»å–æºå›¾æ ‡
          icon = Image.open('temp_icons/app_icon.png')
          
          # è½¬æ¢ä¸º RGBA æ¨¡å¼ï¼ˆå¦‚æœéœ€è¦ï¼‰
          if icon.mode != 'RGBA':
              icon = icon.convert('RGBA')
          
          # 1. è½¬æ¢ä¸º ICO æ ¼å¼ (256x256) - Windows runner å›¾æ ‡
          icon_256 = icon.resize((256, 256), Image.Resampling.LANCZOS)
          icon_256.save('windows/runner/resources/app_icon.ico', format='ICO', sizes=[(256, 256)])
          print('[OK] Generated windows/runner/resources/app_icon.ico')
          
          # 2. åˆ›å»º assets/images ç›®å½•
          os.makedirs('assets/images', exist_ok=True)
          
          # 3. ç”Ÿæˆ 550x550 PNG (assets ç›®å½•)
          icon_550 = icon.resize((550, 550), Image.Resampling.LANCZOS)
          icon_550.save('assets/images/icon.png', format='PNG')
          print('[OK] Generated assets/images/icon.png')
          
          # 4. ç”Ÿæˆ 256x256 ICO (assets ç›®å½•)
          icon_256.save('assets/images/icon.ico', format='ICO', sizes=[(256, 256)])
          print('[OK] Generated assets/images/icon.ico')
          
          print('[SUCCESS] All icons converted successfully!')
          "@ | Out-File -FilePath convert_icon.py -Encoding UTF8
          
          # æ‰§è¡Œ Python è„šæœ¬
          python convert_icon.py
          
          # æ¸…ç†ä¸´æ—¶è„šæœ¬
          Remove-Item convert_icon.py
          
          Write-Host "å·²æˆåŠŸæ›¿æ¢æ‰€æœ‰å›¾æ ‡" -ForegroundColor Green
        shell: pwsh
        
      # ============================================
      # æ­¥éª¤ 11: æ›¿æ¢æ‰€æœ‰FlClashç›¸å…³å­—ç¬¦ä¸²
      # ============================================
      - name: æ›¿æ¢æ‰€æœ‰FlClashç›¸å…³å­—ç¬¦ä¸²ï¼ˆæ”¹è¿›ç‰ˆï¼‰
        run: |
          $app_id = "${{ github.event.inputs.app_id }}"
          $hasError = $false
          
          # 1. æ›¿æ¢windows.rsä¸­çš„æœåŠ¡åç§°
          $windowsRsFile = "services/helper/src/service/windows.rs"
          if (Test-Path $windowsRsFile) {
            $content = Get-Content $windowsRsFile -Raw
            $content = $content.Replace('const SERVICE_NAME: &str = "FlClashHelperService";', "const SERVICE_NAME: &str = `"${app_id}HelperService`";")
            $content | Set-Content $windowsRsFile -Force -Encoding UTF8
            
            # éªŒè¯æ›¿æ¢
            $verify = Get-Content $windowsRsFile -Raw
            if ($verify -match "FlClashHelperService") {
              Write-Host "  âŒ windows.rs æ›¿æ¢å¤±è´¥" -ForegroundColor Red
              $hasError = $true
            } else {
              Write-Host "  âœ… windows.rs æœåŠ¡åç§°æ›¿æ¢æˆåŠŸ: ${app_id}HelperService" -ForegroundColor Green
            }
          }
          
          # 2. æ›¿æ¢constant.dartä¸­çš„ç›¸å…³å¸¸é‡
          $constantDartFile = "lib/common/constant.dart"
          if (Test-Path $constantDartFile) {
            $content = Get-Content $constantDartFile -Raw
            
            # æŒ‰é¡ºåºæ›¿æ¢ï¼ˆå…ˆæ›¿æ¢é•¿çš„ï¼Œé¿å…éƒ¨åˆ†åŒ¹é…ï¼‰
            $content = $content.Replace("const appHelperService = 'FlClashHelperService';", "const appHelperService = '${app_id}HelperService';")
            $content = $content.Replace("const appName = 'FlClash';", "const appName = '$app_id';")
            $content = $content.Replace("FlClashSocket_", "${app_id}Socket_")
            $content = $content.Replace("'FlClashMainIsolate'", "'${app_id}MainIsolate'")
            $content = $content.Replace("'FlClashServiceIsolate'", "'${app_id}ServiceIsolate'")
            $content = $content.Replace("'FlClashHelperService'", "'${app_id}HelperService'")
            
            $content | Set-Content $constantDartFile -Force -Encoding UTF8
            
            # éªŒè¯æ›¿æ¢
            $verify = Get-Content $constantDartFile -Raw
            if ($verify -match "const appName = 'FlClash';") {
              Write-Host "  âŒ appName æ›¿æ¢å¤±è´¥" -ForegroundColor Red
              $hasError = $true
            } elseif ($verify -match "const appHelperService = 'FlClashHelperService';") {
              Write-Host "  âŒ appHelperService æ›¿æ¢å¤±è´¥" -ForegroundColor Red
              $hasError = $true
            } elseif ($verify -match "FlClashSocket_") {
              Write-Host "  âŒ unixSocketPath æ›¿æ¢å¤±è´¥" -ForegroundColor Red
              $hasError = $true
            } else {
              Write-Host "  âœ… constant.dart æ‰€æœ‰å¸¸é‡æ›¿æ¢æˆåŠŸ" -ForegroundColor Green
              Get-Content $constantDartFile | Select-String -Pattern "const appName|const appHelperService|Socket_" | ForEach-Object { Write-Host "    $_" -ForegroundColor Cyan }
            }
          } else {
            Write-Host "  âŒ æ‰¾ä¸åˆ° $constantDartFile æ–‡ä»¶" -ForegroundColor Red
            $hasError = $true
          }
          
          # 3. æ›¿æ¢path.dartä¸­çš„ç›¸å…³è·¯å¾„ï¼ˆæ”¹è¿›æ›¿æ¢é€»è¾‘ï¼‰
          $pathDartFile = "lib/common/path.dart"
          if (Test-Path $pathDartFile) {
            $content = Get-Content $pathDartFile -Raw
            
            # ä½¿ç”¨æ›´ç²¾ç¡®çš„æ›¿æ¢æ–¹å¼
            # æ›¿æ¢ corePath getter ä¸­çš„ FlClashCore
            $content = $content -replace "join\(executableDirPath,\s*'FlClashCore\`$executableExtension'\)", "join(executableDirPath, '${app_id}Core`$executableExtension')"
            # å¤‡ç”¨ï¼šç›´æ¥å­—ç¬¦ä¸²æ›¿æ¢
            $content = $content.Replace("'FlClashCore`$executableExtension'", "'${app_id}Core`$executableExtension'")
            # æ›¿æ¢ lockFilePath ä¸­çš„ FlClash.lock
            $content = $content.Replace("'FlClash.lock'", "'${app_id}.lock'")
            
            $content | Set-Content $pathDartFile -Force -Encoding UTF8
            
            # ä¸¥æ ¼éªŒè¯æ›¿æ¢
            $verify = Get-Content $pathDartFile -Raw
            if ($verify -match "FlClashCore") {
              Write-Host "  âŒ path.dart ä¸­ corePath æ›¿æ¢å¤±è´¥ - å‘ç°æ®‹ç•™ FlClashCore" -ForegroundColor Red
              Write-Host "     è¿™ä¼šå¯¼è‡´åº”ç”¨æ— æ³•æ‰¾åˆ°æ ¸å¿ƒæ–‡ä»¶ï¼" -ForegroundColor Red
              $hasError = $true
            } elseif ($verify -match "'FlClash\.lock'") {
              Write-Host "  âŒ path.dart ä¸­ lockFilePath æ›¿æ¢å¤±è´¥" -ForegroundColor Red
              $hasError = $true
            } else {
              Write-Host "  âœ… path.dart æ‰€æœ‰è·¯å¾„æ›¿æ¢æˆåŠŸ" -ForegroundColor Green
              Get-Content $pathDartFile | Select-String -Pattern "corePath|lockFilePath" | ForEach-Object { Write-Host "    $_" -ForegroundColor Cyan }
            }
          } else {
            Write-Host "  âŒ æ‰¾ä¸åˆ° $pathDartFile æ–‡ä»¶" -ForegroundColor Red
            $hasError = $true
          }
          
          # æœ€ç»ˆæ£€æŸ¥
          if ($hasError) {
            Write-Host "`nâŒâŒâŒ æ›¿æ¢è¿‡ç¨‹ä¸­å‘ç°é”™è¯¯ï¼Œæ„å»ºå¤±è´¥ï¼" -ForegroundColor Red
            Write-Host "è¯·æ£€æŸ¥ä¸Šè¿°é”™è¯¯ä¿¡æ¯" -ForegroundColor Red
            exit 1
          } else {
            Write-Host "`nâœ…âœ…âœ… æ‰€æœ‰FlClashç›¸å…³å­—ç¬¦ä¸²æ›¿æ¢å®Œæˆå¹¶éªŒè¯é€šè¿‡ï¼" -ForegroundColor Green
          }
        shell: pwsh

      # ============================================
      # æ­¥éª¤ 12: ä¿®æ”¹ç™»å½•é¡µé¢æ‰€æœ‰ OpenClash ä¸ºæ˜¾ç¤ºåç§°
      # ============================================
      - name: ä¿®æ”¹ç™»å½•é¡µé¢æ‰€æœ‰ OpenClash ä¸ºæ˜¾ç¤ºåç§°
        run: |
          $loginPageFile = "lib/pages/login_page.dart"
          $displayName = "${{ github.event.inputs.display_name }}"
          $content = Get-Content $loginPageFile -Raw

          # å…¨å±€æ›¿æ¢æ‰€æœ‰ OpenClash ä¸ºæ˜¾ç¤ºåç§°
          $content = $content.Replace("OpenClash", $displayName)

          # å†™å›æ–‡ä»¶
          $content | Set-Content $loginPageFile -Force -Encoding UTF8

          Write-Host "å·²å°†ç™»å½•é¡µé¢æ‰€æœ‰ OpenClash æ›¿æ¢ä¸º '$displayName'"
        shell: pwsh

      # ============================================
      # æ­¥éª¤ 13: ä¿®å¤ä¸­æ–‡å®‰è£…ç›®å½•åç§°é—®é¢˜
      # ============================================
      - name: ä¿®å¤ä¸­æ–‡å®‰è£…ç›®å½•åç§°é—®é¢˜
        run: |
          $displayName = "${{ github.event.inputs.display_name }}"
          $app_id = "${{ github.event.inputs.app_id }}"
          
          # 1. ä¿®æ”¹MakeExeConfigç±»ï¼Œå¼ºåˆ¶ä½¿ç”¨è‹±æ–‡ç›®å½•å
          $makeExeConfigFile = "plugins/flutter_distributor/packages/flutter_app_packager/lib/src/makers/exe/make_exe_config.dart"
          if (Test-Path $makeExeConfigFile) {
            $content = Get-Content $makeExeConfigFile -Raw
            
            # ä¿®æ”¹defaultInstallDirNameæ–¹æ³•ï¼Œç¡®ä¿ä½¿ç”¨è‹±æ–‡ç›®å½•å
            $oldPattern = "String get defaultInstallDirName => '\{autopf64\}\\\\\\$appName';"
            $newPattern = "String get defaultInstallDirName => '{autopf64}\\\\' + appName.replaceAll(RegExp(r'[^a-zA-Z0-9_\\-]'), '_');"
            
            if ($content -match [regex]::Escape($oldPattern)) {
              $content = $content -replace [regex]::Escape($oldPattern), $newPattern
              Write-Host "å·²ä¿®æ”¹MakeExeConfigç±»ï¼Œé¿å…ä¸­æ–‡å®‰è£…ç›®å½•å" -ForegroundColor Green
            }
            
            # å†™å›æ–‡ä»¶
            $content | Set-Content $makeExeConfigFile -Force -Encoding UTF8
          } else {
            Write-Host "è­¦å‘Š: æ‰¾ä¸åˆ° MakeExeConfig æ–‡ä»¶ï¼Œè·³è¿‡ä¿®æ”¹" -ForegroundColor Yellow
          }
          
          # 2. ç¡®ä¿make_config.yamlä¸­æ˜ç¡®æŒ‡å®šè‹±æ–‡å®‰è£…ç›®å½•å
          $makeConfigFile = "windows/packaging/exe/make_config.yaml"
          if (Test-Path $makeConfigFile) {
            $content = Get-Content $makeConfigFile -Raw
            
            # æ·»åŠ æˆ–ä¿®æ”¹å®‰è£…ç›®å½•åç§°é…ç½®
            if ($content -match "install_dir_name:") {
              $content = $content -replace "install_dir_name: .*", "install_dir_name: `"{autopf64}\\$app_id`""
            } else {
              $content += "`ninstall_dir_name: `"{autopf64}\\$app_id`""
            }
            
            # å†™å›æ–‡ä»¶
            $content | Set-Content $makeConfigFile -Force
            
            Write-Host "å·²åœ¨make_config.yamlä¸­è®¾ç½®è‹±æ–‡å®‰è£…ç›®å½•å: `"{autopf64}\\$app_id`"" -ForegroundColor Green
          }
          
          Write-Host "ä¸­æ–‡å®‰è£…ç›®å½•åç§°é—®é¢˜ä¿®å¤å®Œæˆ" -ForegroundColor Green
        shell: pwsh

      # ============================================
      # æ­¥éª¤ 14: ä¿®æ”¹åº”ç”¨çª—å£æ ‡é¢˜å’Œæ‰˜ç›˜åç§°
      # ============================================
      - name: ä¿®æ”¹åº”ç”¨çª—å£æ ‡é¢˜å’Œæ‰˜ç›˜åç§°
        run: |
          $displayName = "${{ github.event.inputs.display_name }}"
          
          # 1. ä¿®æ”¹çª—å£æ ‡é¢˜æ ç»„ä»¶
          $windowManagerFile = "lib/manager/window_manager.dart"
          if (Test-Path $windowManagerFile) {
            $content = Get-Content $windowManagerFile -Raw
            $content = $content -replace 'Text\(\s*appName,', "Text(`"$displayName`","
            $content | Set-Content $windowManagerFile -Force -Encoding UTF8
            Write-Host "å·²ä¿®æ”¹çª—å£æ ‡é¢˜æ æ–‡æœ¬ä¸º: $displayName"
          }
          
          # 2. ä¿®æ”¹åŸç”Ÿçª—å£æ ‡é¢˜
          $mainCppFile = "windows/runner/main.cpp"
          if (Test-Path $mainCppFile) {
            # æ£€æµ‹æ˜¯å¦åŒ…å«ä¸­æ–‡å­—ç¬¦
            $containsChinese = $displayName -match '[\u4e00-\u9fff]'
            
            if ($containsChinese) {
              # è½¬æ¢ä¸­æ–‡åˆ°Unicodeè½¬ä¹‰åºåˆ—
              $unicodeTitle = ""
              foreach ($char in $displayName.ToCharArray()) {
                # å¦‚æœæ˜¯ASCIIå­—ç¬¦ï¼Œä¿æŒåŸæ ·
                if ([int][char]$char -lt 128) {
                  $unicodeTitle += $char
                } else {
                  # è½¬æ¢ä¸ºUnicodeè½¬ä¹‰åºåˆ—
                  $unicodeTitle += "\u" + ([int][char]$char).ToString("X4")
                }
              }
              # ä½¿ç”¨Unicodeè½¬ä¹‰åºåˆ—æ›¿æ¢çª—å£æ ‡é¢˜
              (Get-Content $mainCppFile) -replace 'if \(!window.Create\(L"FlClash", origin, size\)\)', "if (!window.Create(L`"$unicodeTitle`", origin, size))" | Set-Content $mainCppFile
              Write-Host "å·²ä¿®æ”¹WindowsåŸç”Ÿçª—å£æ ‡é¢˜ (ä½¿ç”¨Unicodeè½¬ä¹‰åºåˆ—)"
            } else {
              # ä¸åŒ…å«ä¸­æ–‡ï¼Œç›´æ¥ä½¿ç”¨åŸå­—ç¬¦ä¸²
              (Get-Content $mainCppFile) -replace 'if \(!window.Create\(L"FlClash", origin, size\)\)', "if (!window.Create(L`"$displayName`", origin, size))" | Set-Content $mainCppFile
              Write-Host "å·²ä¿®æ”¹WindowsåŸç”Ÿçª—å£æ ‡é¢˜"
            }
          }
          
          # 3. ä¿®æ”¹æ‰˜ç›˜æç¤ºæ–‡æœ¬
          $trayFile = "lib/common/tray.dart"
          if (Test-Path $trayFile) {
            $content = Get-Content $trayFile -Raw
            $content = $content -replace 'trayManager\.setToolTip\(\s*appName,', "trayManager.setToolTip(`"$displayName`","
            $content | Set-Content $trayFile -Force -Encoding UTF8
            Write-Host "å·²ä¿®æ”¹æ‰˜ç›˜æç¤ºæ–‡æœ¬ä¸º: $displayName"
          }
          
          # 4. ä¿®æ”¹åº”ç”¨æ ‡é¢˜
          $applicationFile = "lib/application.dart"
          if (Test-Path $applicationFile) {
            $content = Get-Content $applicationFile -Raw
            $content = $content -replace 'title: appName,', "title: `"$displayName`","
            $content | Set-Content $applicationFile -Force -Encoding UTF8
            Write-Host "å·²ä¿®æ”¹åº”ç”¨æ ‡é¢˜ä¸º: $displayName"
          }
        shell: pwsh

      # ============================================
      # æ­¥éª¤ 15: ä¿®æ”¹Runner.rcä¸­çš„äº§å“åç§°
      # ============================================
      - name: ä¿®æ”¹Runner.rcä¸­çš„äº§å“åç§°
        run: |
          $displayName = "${{ github.event.inputs.display_name }}"
          $app_id = "${{ github.event.inputs.app_id }}"
          
          # ä¿®æ”¹Runner.rcä¸­çš„äº§å“åç§° - å°†ProductNameè®¾ä¸ºè‹±æ–‡app_idï¼ŒFileDescriptionä¿æŒä¸­æ–‡displayName
          $rcFile = "windows/runner/Runner.rc"
          if (Test-Path $rcFile) {
            (Get-Content $rcFile) -replace 'VALUE "CompanyName", ".*"', "VALUE `"CompanyName`", `"$app_id`"" | Set-Content $rcFile
            (Get-Content $rcFile) -replace 'VALUE "ProductName", ".*"', "VALUE `"ProductName`", `"$app_id`"" | Set-Content $rcFile
            (Get-Content $rcFile) -replace 'VALUE "FileDescription", ".*"', "VALUE `"FileDescription`", `"$displayName`"" | Set-Content $rcFile
            (Get-Content $rcFile) -replace 'VALUE "InternalName", ".*"', "VALUE `"InternalName`", `"$displayName`"" | Set-Content $rcFile
            (Get-Content $rcFile) -replace 'VALUE "OriginalFilename", ".*"', "VALUE `"OriginalFilename`", `"$app_id.exe`"" | Set-Content $rcFile
            Write-Host "å·²ä¿®æ”¹ $rcFile ä¸­çš„äº§å“åç§°ä¸º $app_id (å†…éƒ¨æ ‡è¯†ç¬¦)ï¼Œæ–‡ä»¶æè¿°ä¸º $displayName (æ˜¾ç¤ºåç§°)"
            Write-Host "CompanyName å·²è®¾ç½®ä¸º: $app_id" -ForegroundColor Green
          }
        shell: pwsh

      # ============================================
      # æ­¥éª¤ 16: æ›¿æ¢ inno_setup.iss ä¸­çš„è¿›ç¨‹å
      # ============================================
      - name: æ›¿æ¢ inno_setup.iss ä¸­çš„è¿›ç¨‹å
        run: |
          $app_id = "${{ github.event.inputs.app_id }}"
          $issFile = "windows/packaging/exe/inno_setup.iss"
          if (Test-Path $issFile) {
            $content = Get-Content $issFile -Raw
            
            # ç›´æ¥æŸ¥æ‰¾æ›¿æ¢ï¼ˆå…ˆæ›¿æ¢é•¿çš„ï¼Œé¿å…éƒ¨åˆ†åŒ¹é…ï¼‰
            $content = $content.Replace("FlClashHelperService.exe", "${app_id}HelperService.exe")
            $content = $content.Replace("FlClashCore.exe", "${app_id}Core.exe")
            $content = $content.Replace("FlClash.exe", "${app_id}.exe")
            
            # å†™å›æ–‡ä»¶
            $content | Set-Content $issFile -Force -Encoding UTF8
            Write-Host "å·²æ›¿æ¢ inno_setup.iss ä¸­çš„è¿›ç¨‹å: ${app_id}.exe, ${app_id}Core.exe, ${app_id}HelperService.exe" -ForegroundColor Green
            
            # éªŒè¯æ›¿æ¢ç»“æœ
            Write-Host "`néªŒè¯æ›¿æ¢ç»“æœ:" -ForegroundColor Yellow
            Get-Content $issFile | Select-String -Pattern "Processes :=" -Context 0,3 | ForEach-Object { Write-Host "  $_" -ForegroundColor Cyan }
          } else {
            Write-Host "è­¦å‘Š: æ‰¾ä¸åˆ° inno_setup.iss æ–‡ä»¶" -ForegroundColor Red
          }
        shell: pwsh      
        
      # ============================================
      # æ­¥éª¤ 17: ç¡®ä¿Windowså®‰è£…ç¨‹åºé…ç½®æ¡Œé¢å¿«æ·æ–¹å¼
      # ============================================
      - name: ç¡®ä¿Windowså®‰è£…ç¨‹åºé…ç½®æ¡Œé¢å¿«æ·æ–¹å¼
        run: |
          $displayName = "${{ github.event.inputs.display_name }}"
          $app_id = "${{ github.event.inputs.app_id }}"
          
          # ç¡®ä¿Windowså®‰è£…ç¨‹åºé…ç½®æ–‡ä»¶ä½¿ç”¨ä¸€è‡´çš„åç§°
          $makeConfigFile = "windows/packaging/exe/make_config.yaml"
          if (Test-Path $makeConfigFile) {
            $content = Get-Content $makeConfigFile -Raw
            
            # ä»…ä¿®æ”¹æ˜¾ç¤ºåç§°
            $content = $content -replace "display_name: .*", "display_name: $displayName"
            
            # å†æ¬¡ç¡®ä¿å®‰è£…ç›®å½•åç§°ä½¿ç”¨è‹±æ–‡app_id
            if ($content -match "install_dir_name:") {
              $content = $content -replace "install_dir_name: .*", "install_dir_name: `"{autopf64}\\$app_id`""
            } else {
              $content += "`ninstall_dir_name: `"{autopf64}\\$app_id`""
            }
            
            # ç¡®ä¿åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼
            if ($content -notmatch "create_desktop_icon:") {
              $content += "`ncreate_desktop_icon: true`n"
            } else {
              $content = $content -replace "create_desktop_icon: false", "create_desktop_icon: true"
            }
            
            # å†™å›æ–‡ä»¶
            $content | Set-Content $makeConfigFile -Force
            
            Write-Host "å·²æ›´æ–°Windowså®‰è£…ç¨‹åºé…ç½®ï¼Œç¡®ä¿åˆ›å»ºæ¡Œé¢å›¾æ ‡å¹¶ä½¿ç”¨è‹±æ–‡å®‰è£…ç›®å½•å:"
            Get-Content $makeConfigFile
          }
        shell: pwsh
        
      # ============================================
      # æ­¥éª¤ 18: ä¿®æ”¹ setup.dart ä¸­çš„ appName
      # ============================================
      - name: ä¿®æ”¹ setup.dart ä¸­çš„ appName
        run: |
          $app_id = "${{ github.event.inputs.app_id }}"
          $setupFile = "setup.dart"
          
          # è¯»å–æ–‡ä»¶å†…å®¹
          $content = Get-Content $setupFile -Raw
          
          # ç›´æ¥æŸ¥æ‰¾æ›¿æ¢ï¼ˆå•å¼•å·ï¼‰
          $content = $content.Replace("static String get appName => 'FlClash';", "static String get appName => '$app_id';")
          
          # å†™å›æ–‡ä»¶
          $content | Set-Content $setupFile -Force -Encoding UTF8
          
          Write-Host "å·²ä¿®æ”¹ setup.dart ä¸­çš„ appName ä¸º: $app_id" -ForegroundColor Green
          
          # éªŒè¯æ›¿æ¢ç»“æœ
          Write-Host "`néªŒè¯æ›¿æ¢ç»“æœ:" -ForegroundColor Yellow
          Get-Content $setupFile | Select-String -Pattern "static String get appName" | ForEach-Object { Write-Host "  $_" -ForegroundColor Cyan }
        shell: pwsh

      - name: ğŸ” æœ€ç»ˆéªŒè¯æ‰€æœ‰å…³é”®æ›¿æ¢
        run: |
          Write-Host "========================================" -ForegroundColor Cyan
          Write-Host "   æœ€ç»ˆéªŒè¯ï¼šç¡®ä¿é€€å‡ºæ—¶èƒ½æ­£ç¡®æ¸…ç†è¿›ç¨‹" -ForegroundColor Cyan
          Write-Host "========================================" -ForegroundColor Cyan
          
          $app_id = "${{ github.event.inputs.app_id }}"
          $allPassed = $true
          
          # æ£€æŸ¥å…³é”®æ–‡ä»¶
          $checks = @(
            @{
              File = "lib/common/constant.dart"
              Pattern = "FlClashHelperService|const appName = 'FlClash';"
              Name = "å¸¸é‡å®šä¹‰"
            },
            @{
              File = "lib/common/path.dart"
              Pattern = "FlClashCore|'FlClash\.lock'"
              Name = "è·¯å¾„é…ç½®"
            },
            @{
              File = "services/helper/src/service/windows.rs"
              Pattern = 'SERVICE_NAME.*FlClashHelperService'
              Name = "WindowsæœåŠ¡å"
            },
            @{
              File = "windows/packaging/exe/inno_setup.iss"
              Pattern = "FlClash\.exe|FlClashCore\.exe|FlClashHelperService\.exe"
              Name = "å®‰è£…è„šæœ¬è¿›ç¨‹å"
            }
          )
          
          foreach ($check in $checks) {
            if (Test-Path $check.File) {
              $content = Get-Content $check.File -Raw
              if ($content -match $check.Pattern) {
                Write-Host "âŒ $($check.Name) ($($check.File)): å‘ç°æœªæ›¿æ¢çš„FlClashå¼•ç”¨" -ForegroundColor Red
                # æ˜¾ç¤ºåŒ¹é…çš„è¡Œ
                Get-Content $check.File | Select-String -Pattern $check.Pattern | ForEach-Object {
                  Write-Host "   è¡Œ $($_.LineNumber): $($_.Line)" -ForegroundColor Yellow
                }
                $allPassed = $false
              } else {
                Write-Host "âœ… $($check.Name) ($($check.File)): éªŒè¯é€šè¿‡" -ForegroundColor Green
              }
            } else {
              Write-Host "âš ï¸  $($check.Name) ($($check.File)): æ–‡ä»¶ä¸å­˜åœ¨" -ForegroundColor Yellow
            }
          }
          
          # éªŒè¯æ ¸å¿ƒæ›¿æ¢
          Write-Host "`nå…³é”®é…ç½®éªŒè¯:" -ForegroundColor Cyan
          Write-Host "  åº”ç”¨ID: $app_id" -ForegroundColor White
          
          if (Test-Path "lib/common/constant.dart") {
            $appNameLine = Get-Content "lib/common/constant.dart" | Select-String "const appName"
            $helperLine = Get-Content "lib/common/constant.dart" | Select-String "const appHelperService"
            Write-Host "  AppName: $appNameLine" -ForegroundColor White
            Write-Host "  HelperService: $helperLine" -ForegroundColor White
          }
          
          if (Test-Path "lib/common/path.dart") {
            $corePathLine = Get-Content "lib/common/path.dart" | Select-String "corePath" -Context 0,2
            Write-Host "  CorePathé…ç½®:" -ForegroundColor White
            $corePathLine | ForEach-Object { Write-Host "    $_" -ForegroundColor Gray }
          }
          
          Write-Host "`n========================================" -ForegroundColor Cyan
          if ($allPassed) {
            Write-Host "âœ…âœ…âœ… æ‰€æœ‰éªŒè¯é€šè¿‡ï¼é€€å‡ºæµç¨‹å°†æ­£ç¡®æ¸…ç†æ‰€æœ‰è¿›ç¨‹" -ForegroundColor Green
            Write-Host "========================================" -ForegroundColor Cyan
          } else {
            Write-Host "âŒâŒâŒ éªŒè¯å¤±è´¥ï¼è¯·ä¿®å¤ä¸Šè¿°é—®é¢˜" -ForegroundColor Red
            Write-Host "========================================" -ForegroundColor Cyan
            exit 1
          }
        shell: pwsh

      # ============================================
      # æ­¥éª¤ 19: è®¾ç½® Go ç¯å¢ƒ
      # ============================================
      - name: è®¾ç½® Go ç¯å¢ƒ
        uses: actions/setup-go@v5
        with:
          go-version: '1.24.0'
          cache-dependency-path: |
            core/go.sum
            
      # ============================================
      # æ­¥éª¤ 20: è®¾ç½® Flutter Master ç¯å¢ƒ (ARM64 å¿…éœ€)
      # ============================================
      - name: è®¾ç½® Flutter Master ç¯å¢ƒ (ARM64)
        uses: subosito/flutter-action@v2
        with:
          channel: master  # Windows ARM64 å¿…é¡»ä½¿ç”¨ master é€šé“
          cache: true

      # ============================================
      # æ­¥éª¤ 21: è·å– Flutter ä¾èµ–
      # ============================================
      - name: è·å– Flutter ä¾èµ–
        run: flutter pub get

      # ============================================
      # æ­¥éª¤ 22: æ‰§è¡Œæ„å»ºè„šæœ¬ (ARM64 æ¶æ„)
      # ============================================
      - name: æ‰§è¡Œæ„å»ºè„šæœ¬
        run: dart setup.dart windows --arch arm64 --env stable
      
      # ============================================
      # æ­¥éª¤ 23: æ£€æŸ¥æ„å»ºäº§ç‰©
      # ============================================
      - name: æ£€æŸ¥æ„å»ºäº§ç‰©
        run: |
          Write-Host "æ£€æŸ¥æ„å»ºäº§ç‰©..." -ForegroundColor Yellow
          
          # åˆ—å‡ºdistç›®å½•å†…å®¹
          if (Test-Path "dist") {
            Write-Host "distç›®å½•å†…å®¹:" -ForegroundColor Green
            Get-ChildItem -Path "dist" -Recurse | ForEach-Object {
              Write-Host "  $($_.FullName)" -ForegroundColor Cyan
            }
          } else {
            Write-Host "distç›®å½•ä¸å­˜åœ¨" -ForegroundColor Red
          }
          
          # åˆ—å‡ºbuildç›®å½•å†…å®¹
          if (Test-Path "build/windows/arm64/runner/Release") {
            Write-Host "build/windows/arm64/runner/Releaseç›®å½•å†…å®¹:" -ForegroundColor Green
            Get-ChildItem -Path "build/windows/arm64/runner/Release" -Recurse | ForEach-Object {
              Write-Host "  $($_.FullName)" -ForegroundColor Cyan
            }
          } else {
            Write-Host "build/windows/arm64/runner/Releaseç›®å½•ä¸å­˜åœ¨" -ForegroundColor Yellow
          }
          
          # æœç´¢æ‰€æœ‰exeæ–‡ä»¶
          Write-Host "æœç´¢æ‰€æœ‰exeæ–‡ä»¶:" -ForegroundColor Yellow
          Get-ChildItem -Path "." -Filter "*.exe" -Recurse | ForEach-Object {
            Write-Host "  æ‰¾åˆ°exeæ–‡ä»¶: $($_.FullName)" -ForegroundColor Green
          }
        shell: pwsh
      
      # ============================================
      # æ­¥éª¤ 24: ä¸Šä¼ æ„å»ºäº§ç‰©
      # ============================================
      - name: ä¸Šä¼ æ„å»ºäº§ç‰©
        uses: actions/upload-artifact@v4
        with:
          name: ${{ github.event.inputs.app_id }}-${{ github.event.inputs.version }}-windows-arm64
          path: dist/
          retention-days: 7
          
      # ============================================
      # æ­¥éª¤ 25: ç”Ÿæˆæ„å»ºæ€»ç»“
      # ============================================
      - name: ç”Ÿæˆæ„å»ºæ€»ç»“
        run: |
          echo "## ğŸ‰ Windows ARM64 æ„å»ºå®Œæˆ" >> $env:GITHUB_STEP_SUMMARY
          echo "" >> $env:GITHUB_STEP_SUMMARY
          echo "### æ„å»ºä¿¡æ¯" >> $env:GITHUB_STEP_SUMMARY
          echo "- **åº”ç”¨åç§°**: ${{ github.event.inputs.display_name }}" >> $env:GITHUB_STEP_SUMMARY
          echo "- **åº”ç”¨ID**: ${{ github.event.inputs.app_id }}" >> $env:GITHUB_STEP_SUMMARY
          echo "- **ç‰ˆæœ¬å·**: ${{ github.event.inputs.version }}" >> $env:GITHUB_STEP_SUMMARY
          echo "- **æ¶æ„**: ARM64" >> $env:GITHUB_STEP_SUMMARY
          echo "- **ç§æœ‰ä»“åº“**: ${{ env.PRIVATE_REPO }}" >> $env:GITHUB_STEP_SUMMARY
          echo "- **åˆ†æ”¯/æ ‡ç­¾**: ${{ env.PRIVATE_REPO_REF }}" >> $env:GITHUB_STEP_SUMMARY
          echo "" >> $env:GITHUB_STEP_SUMMARY
          echo "### æ„å»ºäº§ç‰©" >> $env:GITHUB_STEP_SUMMARY
          echo '```' >> $env:GITHUB_STEP_SUMMARY
          Get-ChildItem -Path dist/ >> $env:GITHUB_STEP_SUMMARY
          echo '```' >> $env:GITHUB_STEP_SUMMARY
        shell: pwsh

